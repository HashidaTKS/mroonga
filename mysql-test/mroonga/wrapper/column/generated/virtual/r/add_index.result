DROP TABLE IF EXISTS logs;
CREATE TABLE logs (
id INT PRIMARY KEY,
record JSON,
level VARCHAR(255) GENERATED ALWAYS AS (json_extract(`record`, '$.level')) VIRTUAL
) ENGINE=Mroonga DEFAULT CHARSET=utf8mb4 COMMENT = 'ENGINE "InnoDB"';
INSERT INTO logs(id, record)
VALUES (1, '{"level": "info", "message": "start server"}');
ALTER TABLE logs ADD INDEX (level);
INSERT INTO logs(id, record)
VALUES (2, '{"level": "info", "message": "start server"}');
INSERT INTO logs(id, record)
VALUES (3, '{"level": "warn", "message": "abort server"}');
EXPLAIN SELECT * FROM logs WHERE level = 'info';
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	logs	ref	level	level	1023	const	1	Using where
DROP TABLE logs;
